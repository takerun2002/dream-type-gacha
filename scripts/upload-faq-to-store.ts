/**
 * FAQãƒ‡ãƒ¼ã‚¿ã‚’æ—¢å­˜ã®File Search Storeã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
 */

import { GoogleGenAI } from "@google/genai";
import * as fs from "fs";
import * as path from "path";

const GEMINI_API_KEY = process.env.GEMINI_API_KEY_SUPPORT || process.env.GEMINI_API_KEY;
const FILE_SEARCH_STORE_NAME = process.env.GEMINI_FILE_SEARCH_STORE_NAME || "fileSearchStores/dreamtypegachafaq-shrheaijatxi";

if (!GEMINI_API_KEY) {
  console.error("âŒ GEMINI_API_KEY ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“");
  process.exit(1);
}

const ai = new GoogleGenAI({ apiKey: GEMINI_API_KEY });

// FAQãƒ‡ãƒ¼ã‚¿
const faqData = [
  {
    id: "faq-008",
    category: "general",
    question: "è¨ºæ–­ã¯ä½•å›ã§ã‚‚ã§ãã¾ã™ã‹ï¼Ÿ",
    answer: `ã„ã„ãˆã€è¨ºæ–­ã¯ãŠã²ã¨ã‚Šæ§˜1å›é™ã‚Šã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚

é‡è¦: ä»–ã®äººã«è¨ºæ–­çµæœã‚’å…±æœ‰ã—ãŸã‚Šã€è¤‡æ•°å›è¨ºæ–­ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

åŒã˜ãƒ‡ãƒã‚¤ã‚¹ãƒ»åŒã˜ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯å†è¨ºæ–­ã§ãã¾ã›ã‚“ã®ã§ã€ã”æ³¨æ„ãã ã•ã„ã€‚

åˆ¥ã®çµæœãŒæ¬²ã—ã„å ´åˆã¯ã€ã‚µãƒãƒ¼ãƒˆã‚»ãƒ³ã‚¿ãƒ¼ã¸ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚`,
    tags: ["è¨ºæ–­", "åˆ¶é™", "1å›é™ã‚Š", "å†è¨ºæ–­", "é‡è¦"],
    priority: 15,
  },
  {
    id: "faq-003",
    category: "general",
    question: "ã‚‚ã†ä¸€åº¦è¨ºæ–­ã—ãŸã„ãƒ»å†è¨ºæ–­ã—ãŸã„",
    answer: `è¨ºæ–­ã¯1äºº1å›é™ã‚Šã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚

åˆ¥ã®çµæœãŒæ¬²ã—ã„å ´åˆã¯:
1. åˆ¥ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¾ãŸã¯ç«¯æœ«ã§ãŠè©¦ã—ãã ã•ã„
2. ã‚µãƒãƒ¼ãƒˆã‚»ãƒ³ã‚¿ãƒ¼ã¸ãŠå•ã„åˆã‚ã›ãã ã•ã„

â€» åŒã˜ãƒ‡ãƒã‚¤ã‚¹ã§ã¯å†è¨ºæ–­ã§ãã¾ã›ã‚“`,
    tags: ["å†è¨ºæ–­", "åˆ¶é™"],
    priority: 8,
  },
  {
    id: "faq-001",
    category: "name_mismatch",
    question: "åˆ¥ã®äººã®åå‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹",
    answer: `å…±æœ‰ãƒ‡ãƒã‚¤ã‚¹ã§è¨ºæ–­ã—ãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

å¯¾å‡¦æ³•:
1. åˆ¥ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¾ãŸã¯ç«¯æœ«ã§ãŠè©¦ã—ãã ã•ã„
2. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¦ãã ã•ã„
3. ãã‚Œã§ã‚‚è§£æ±ºã—ãªã„å ´åˆã¯ã€ã‚µãƒãƒ¼ãƒˆã‚»ãƒ³ã‚¿ãƒ¼ã¸ãŠå•ã„åˆã‚ã›ãã ã•ã„`,
    tags: ["åå‰", "ãƒã‚°", "å…±æœ‰ãƒ‡ãƒã‚¤ã‚¹"],
    priority: 10,
  },
  {
    id: "faq-010",
    category: "name_mismatch",
    question: "ãªãœä»–ã®äººã®ã‚«ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¦ã—ã¾ã†ã®ã‹",
    answer: `æŠ€è¡“çš„ãªåŸå› :

1. ãƒ‡ãƒã‚¤ã‚¹è­˜åˆ¥ã®å•é¡Œ: åŒã˜ãƒ‡ãƒã‚¤ã‚¹ï¼ˆã‚¹ãƒãƒ›ãƒ»PCï¼‰ã‹ã‚‰è¨ºæ–­ã™ã‚‹ã¨ã€ã‚·ã‚¹ãƒ†ãƒ ãŒåŒã˜äººã¨èªè­˜ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™

2. IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å…±æœ‰: åŒã˜Wi-Fiã‚„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒåŒã˜ã«ãªã‚Šã€æ··åŒã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™

3. ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥: ä»¥å‰ã®è¨ºæ–­ãƒ‡ãƒ¼ã‚¿ãŒãƒ–ãƒ©ã‚¦ã‚¶ã«æ®‹ã£ã¦ã„ã‚‹ã¨ã€æ–°ã—ã„è¨ºæ–­ã¨æ··ã–ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™

è§£æ±ºç­–:
- åˆ¥ã®ãƒ‡ãƒã‚¤ã‚¹ã§è¨ºæ–­ã™ã‚‹ï¼ˆæœ€ã‚‚ç¢ºå®Ÿï¼‰
- åˆ¥ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ä½¿ã†ï¼ˆChrome â†’ Safariã€Safari â†’ Chromeï¼‰
- ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ã§è¨ºæ–­ã™ã‚‹
- ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹`,
    tags: ["åå‰", "ãƒã‚°", "åŸå› ", "æŠ€è¡“", "ã‚«ãƒ¼ãƒ‰", "ç”Ÿæˆ"],
    priority: 12,
  },
  {
    id: "faq-011",
    category: "card_issue",
    question: "iPhoneã§ã‚«ãƒ¼ãƒ‰ã‚’ä¿å­˜ã™ã‚‹æ–¹æ³•",
    answer: `iPhoneã§ã®ä¿å­˜æ–¹æ³•:

æ–¹æ³•1: ãƒœã‚¿ãƒ³ã‹ã‚‰ä¿å­˜
1. çµæœç”»é¢ã®ã€Œå†™çœŸã«ä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
2. å†™çœŸã‚¢ãƒ—ãƒªã«ä¿å­˜ã•ã‚Œã¾ã™

æ–¹æ³•2: ç”»åƒã‚’é•·æŠ¼ã—
1. ã‚«ãƒ¼ãƒ‰ç”»åƒã‚’é•·æŠ¼ã—
2. ã€Œç”»åƒã‚’ä¿å­˜ã€ã‚’é¸æŠ
3. å†™çœŸã‚¢ãƒ—ãƒªã«ä¿å­˜ã•ã‚Œã¾ã™

æ–¹æ³•3: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
1. ã‚«ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã§
2. é›»æºãƒœã‚¿ãƒ³ + éŸ³é‡ä¸Šãƒœã‚¿ãƒ³ï¼ˆiPhone Xä»¥é™ï¼‰
3. ã¾ãŸã¯ ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ + é›»æºãƒœã‚¿ãƒ³ï¼ˆiPhone 8ä»¥å‰ï¼‰

ä¿å­˜å¾Œã¯ã€å†™çœŸã‚¢ãƒ—ãƒªã®ã€Œæœ€è¿‘è¿½åŠ ã•ã‚ŒãŸé …ç›®ã€ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚`,
    tags: ["iPhone", "ä¿å­˜", "ã‚«ãƒ¼ãƒ‰", "å†™çœŸ", "iOS"],
    priority: 11,
  },
  {
    id: "faq-012",
    category: "card_issue",
    question: "Androidã§ã‚«ãƒ¼ãƒ‰ã‚’ä¿å­˜ã™ã‚‹æ–¹æ³•",
    answer: `Androidã§ã®ä¿å­˜æ–¹æ³•:

æ–¹æ³•1: ãƒœã‚¿ãƒ³ã‹ã‚‰ä¿å­˜
1. çµæœç”»é¢ã®ã€Œå†™çœŸã«ä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
2. ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‚¢ãƒ—ãƒªã«ä¿å­˜ã•ã‚Œã¾ã™

æ–¹æ³•2: ç”»åƒã‚’é•·æŠ¼ã—
1. ã‚«ãƒ¼ãƒ‰ç”»åƒã‚’é•·æŠ¼ã—
2. ã€Œç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ã¾ãŸã¯ã€Œç”»åƒã‚’ä¿å­˜ã€ã‚’é¸æŠ
3. ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‚¢ãƒ—ãƒªã«ä¿å­˜ã•ã‚Œã¾ã™

æ–¹æ³•3: ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰
1. ã‚«ãƒ¼ãƒ‰ç”»åƒã‚’é•·æŠ¼ã—
2. ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆ3ç‚¹ãƒªãƒ¼ãƒ€ãƒ¼ï¼‰ã‚’ã‚¿ãƒƒãƒ—
3. ã€Œç”»åƒã‚’ä¿å­˜ã€ã‚’é¸æŠ`,
    tags: ["Android", "ä¿å­˜", "ã‚«ãƒ¼ãƒ‰", "å†™çœŸ", "ã‚®ãƒ£ãƒ©ãƒªãƒ¼"],
    priority: 10,
  },
  {
    id: "faq-002",
    category: "card_issue",
    question: "ã‚«ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œãªã„ã€è¡¨ç¤ºã•ã‚Œãªã„",
    answer: `æ··é›‘æ™‚ã¯ç”Ÿæˆã«æ™‚é–“ãŒã‹ã‹ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

å¯¾å‡¦æ³•:
1. ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ï¼ˆæœ€å¤§1-2åˆ†ï¼‰
2. ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„
3. åˆ¥ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ãŠè©¦ã—ãã ã•ã„

ãã‚Œã§ã‚‚è§£æ±ºã—ãªã„å ´åˆã¯ã€ã‚µãƒãƒ¼ãƒˆã‚»ãƒ³ã‚¿ãƒ¼ã¸ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚`,
    tags: ["ã‚«ãƒ¼ãƒ‰", "ç”Ÿæˆ", "è¡¨ç¤º"],
    priority: 9,
  },
  {
    id: "faq-015",
    category: "general",
    question: "è¨ºæ–­ã¯ç„¡æ–™ã§ã™ã‹ï¼Ÿ",
    answer: `ã¯ã„ã€è¨ºæ–­ã¯å®Œå…¨ç„¡æ–™ã§ã™ã€‚

å¤¢ã‚¿ã‚¤ãƒ—è¨ºæ–­ã‚¬ãƒãƒ£ã¯ã€ãã‚“ã¾ã‚“å…ˆç”Ÿã®å¼•ãå¯„ã›ãƒãƒ¼ãƒˆè¬›åº§ã®ç‰¹å…¸ã¨ã—ã¦æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚

è¨ºæ–­ã§å—ã‘å–ã‚Œã‚‹ã‚‚ã®:
- ã‚ãªãŸå°‚ç”¨ã®å¤¢ã‚¿ã‚¤ãƒ—è¨ºæ–­çµæœ
- ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰
- é‘‘å®šæ›¸ï¼ˆãƒ¡ãƒ¼ãƒ«ã§å—ã‘å–ã‚‹ã“ã¨ã‚‚å¯èƒ½ï¼‰

æ³¨æ„:
- è¨ºæ–­ã¯1äºº1å›é™ã‚Šã§ã™
- ä»–ã®äººã«å…±æœ‰ã—ãªã„ã§ãã ã•ã„`,
    tags: ["ç„¡æ–™", "æ–™é‡‘", "ç‰¹å…¸"],
    priority: 2,
  },
];

async function uploadFAQs() {
  console.log("ğŸ“¤ FAQãƒ‡ãƒ¼ã‚¿ã‚’File Search Storeã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...\n");
  console.log(`ğŸ“ Store: ${FILE_SEARCH_STORE_NAME}\n`);

  // ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
  const tmpDir = path.join(process.cwd(), "tmp-faq-upload");
  if (!fs.existsSync(tmpDir)) {
    fs.mkdirSync(tmpDir, { recursive: true });
  }

  for (const faq of faqData) {
    const filename = `${faq.id}.txt`;  // è‹±èªã®ã¿ã®ãƒ•ã‚¡ã‚¤ãƒ«å
    const filePath = path.join(tmpDir, filename);

    // FAQã‚’ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜
    const content = `è³ªå•: ${faq.question}

ã‚«ãƒ†ã‚´ãƒª: ${faq.category}
å„ªå…ˆåº¦: ${faq.priority}
ã‚¿ã‚°: ${faq.tags.join(", ")}

å›ç­”:
${faq.answer}`;

    fs.writeFileSync(filePath, content, "utf-8");

    console.log(`ğŸ“ ${filename} ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...`);

    try {
      const operation = await ai.fileSearchStores.uploadToFileSearchStore({
        file: filePath,
        fileSearchStoreName: FILE_SEARCH_STORE_NAME,
        config: {
          displayName: faq.id,  // è‹±èªã®ã¿ä½¿ç”¨ï¼ˆæ—¥æœ¬èªã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œãªã„ï¼‰
          customMetadata: [
            { key: "category", stringValue: faq.category },
            { key: "priority", numericValue: faq.priority },
            { key: "faq_id", stringValue: faq.id },
          ],
        },
      });

      // å®Œäº†ã‚’å¾…æ©Ÿï¼ˆoperation.doneã‚’ãƒãƒ¼ãƒªãƒ³ã‚°ï¼‰
      await new Promise((resolve) => setTimeout(resolve, 3000));
      console.log(`  âœ… ${faq.id} å®Œäº†`);
    } catch (error) {
      console.error(`  âŒ ${faq.id} ã‚¨ãƒ©ãƒ¼:`, error);
    }

    // ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾ç­–
    await new Promise((resolve) => setTimeout(resolve, 1000));
  }

  // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  fs.rmSync(tmpDir, { recursive: true, force: true });

  console.log("\nâœ¨ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†ï¼");
}

uploadFAQs().catch(console.error);
